---
title: "Fixing the Precompilation Marker File Ektron Issue on IIS 7"
description: "Technical blog post from 2010-04-22"
pubDate: 2010-04-22
tags: ["dotnet", "aspnet", "blogging"]
source: "blogger"
originalUrl: "https://martinondotnet.blogspot.com/"
---

After recently updating a 7.65 based website to 8.0 we recently found that parts of the workarea were unusable.  The upgrade went well and all the pre-deployment checks went well.  However, when we performed the UAT deployment the workarea was broken.  Where the treeview menu on the left should be, there was a helpful message:

     This is a marker file generated by the precompilation tool, and should not be deleted!

   Well, yes the UAT deployment is the first production quality deployment so precompilation is part of the build and this is part of the message that’s within all of the precompiled UI files (aspx, ascx, ashx, etc).  But on a precompiled site, the pages are actually stored in dll’s in the site’s bin folder – the actual files are a nicety to ensure IIS routes the request the ASP.Net.

  Clearly this mechanism was working for aspx files as the frontend website worked as well as bits of the workearea.  After a bit of investigation, it appears that html and htm files are also being precompiled using the standard PageBuildProvider:

```csharp
compilation debug="false">
```

```csharp
buildProviders>
```

```csharp
add extension=".htm"
```

```csharp
type="System.Web.Compilation.PageBuildProvider" />
```

```csharp
add extension=".html"
```

```csharp
type="System.Web.Compilation.PageBuildProvider" />
```

```csharp
buildProviders>
```

```csharp
compilation>
```

## The Fix

In the web.config ensure the following handler mappings  are added to configuration/system.webServer/handlers:

  
```csharp



```csharp
Add Under the aspx mapping for Integrated Mode 
```

```csharp



```csharp
-->
```

```csharp
add name="Html-Integrated" path="*.html" verb="GET,HEAD,POST,DEBUG" type="System.Web.UI.PageHandlerFactory" preCondition="integratedMode"/>
```

```csharp
add name="Htm-Integrated" path="*.htm" verb="GET,HEAD,POST,DEBUG" type="System.Web.UI.PageHandlerFactory" preCondition="integratedMode"/>
```

```csharp



```csharp



```csharp
-->
```

```csharp
add name="Html-ISAPI-2.0" path="*.html" verb="GET,HEAD,POST,DEBUG" modules="IsapiModule" scriptProcessor="%windir%\Microsoft.NET\Framework\v2.0.50727\aspnet_isapi.dll" preCondition="classicMode,runtimeVersionv2.0,bitness32" responseBufferLimit="0"/>
```

```csharp
add name="Htm-ISAPI-2.0" path="*.htm" verb="GET,HEAD,POST,DEBUG" modules="IsapiModule" scriptProcessor="%windir%\Microsoft.NET\Framework\v2.0.50727\aspnet_isapi.dll" preCondition="classicMode,runtimeVersionv2.0,bitness32" responseBufferLimit="0"/>
```

```csharp



The lines above are for IIS 7, if the same issue occurs on an earlier version then it should be trivial to add appropriate entries to configuration/system.web/httpHandlers.

It’s important that these handlers are registered prior to any wildcard handlers (path=”*.*”) and is mapped to the standard ASP.Net handler.  If it’s mapped to the [Ektron](http://bit.ly/d0YHh7) EkDavHttpHandlerFactory then the html and htm files will be served as text and not processed as a serverside page.
