#!/bin/bash
# Pre-push hook: Quality gate for content and build validation
set -e

echo "ğŸ” Pre-push quality checks..."

# Check for secrets
echo "ğŸ”’ Checking for secrets..."
if ! npm run lint:secrets; then
    echo "âŒ Secrets detected. Remove credentials before pushing."
    exit 1
fi

# Run format check
echo "ğŸ“ Checking code formatting..."
if ! npm run lint:format; then
    echo "âŒ Code formatting check failed. Run 'npm run format' to fix."
    exit 1
fi

# Run markdown lint
echo "ğŸ“ Checking markdown files..."
if ! npm run lint:md; then
    echo "âŒ Markdown lint failed. Run 'npm run format:md' to auto-fix issues."
    exit 1
fi

# Validate assets
echo "ğŸ–¼ï¸  Validating assets..."
if ! npm run lint:assets; then
    echo "âŒ Asset validation failed. Check for missing or orphaned images."
    exit 1
fi

# Run build to ensure site compiles
echo "ğŸ”¨ Building site..."
if ! npm run build; then
    echo "âŒ Build failed. Fix errors before pushing."
    exit 1
fi

echo "âœ… All checks passed!"
